<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Webcam Image</title>
    <style>
        #boxContainer {
            display: flex;
            flex-wrap: wrap;
        }
        .user-box {
            margin: 10px;
            display: inline-block;
        }
        .user-box img {
            width: 100px;
            height: 100px;
        }
    </style>
</head>
<body>
    <h1>User Webcam Image</h1>
    <div id="boxContainer"></div>
    <video id="localVideo" width="320" height="320" autoplay></video>
    <canvas id="canvas" width="320" height="240"></canvas>
    <button id="captureButton">Capture</button>
    <!-- <video id="localVideo" autoplay muted style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <button id="captureButton">Capture Image</button> -->

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
        const boxContainer = document.getElementById('boxContainer');
        const localVideo = document.getElementById('localVideo');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const captureButton = document.getElementById('captureButton');

        // Generate a unique ID for this client
        const clientId = 'client_' + Math.random().toString(36).substr(2, 9);

        // Get webcam video stream
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                
                localVideo.srcObject = stream;
                localVideo.addEventListener('loadeddata', () => {
                    console.log('Video is loaded and playing');
                });
            })
            .catch(err => {
                console.error('Error accessing webcam: ', err);
            });

        // Capture image from webcam and send to server
        // captureButton.addEventListener('click', () => {
        //     if (localVideo.videoWidth > 0 && localVideo.videoHeight > 0) {
        //         canvas.width = localVideo.videoWidth;
        //         canvas.height = localVideo.videoHeight;
        //         context.drawImage(localVideo, 0, 0, canvas.width, canvas.height);
        //         const dataURL = canvas.toDataURL('image/jpeg');
        //         console.log('Captured image dataURL:', dataURL); // Debugging line
        //         socket.emit('image_capture', { clientId: clientId, image: dataURL });
        //     } else {
        //         console.error('Video dimensions are invalid.');
        //     }
        // });
        // captureButton.addEventListener('click', () => {
        //     canvas.getContext('2d').drawImage(localVideo, 0, 0, canvas.width, canvas.height);
        //     const imageData = canvas.toDataURL('image/jpeg'); 
        //     socket.emit('image_capture', { clientId: clientId, image: imageData });
        // });

        localVideo.addEventListener('play', () => {
            const canvasContext = canvas.getContext('2d');
            canvas.width = localVideo.videoWidth;
            canvas.height = localVideo.videoHeight;

            const intervalId = setInterval(() => {
                canvasContext.drawImage(localVideo, 0, 0, canvas.width, canvas.height);
                const imageData = canvas.toDataURL('image/jpeg');
                socket.emit('image_capture', { clientId: clientId, image: imageData });
            }, 50); // Adjust interval for desired frame rate
        });
        // Receive and display broadcasted images in specific divs
        socket.on('broadcast_image', (data) => {
            let userDiv = document.getElementById(data.clientId);
            console.log('Captured image dataURL:', userDiv);
            if (!userDiv) {
                userDiv = document.createElement('div');
                userDiv.id = data.clientId;
                userDiv.classList.add('user-box');
                
                const imgElement = document.createElement('img');
                imgElement.src = data.image;
                userDiv.appendChild(imgElement);

                boxContainer.appendChild(userDiv);
            } else {
                userDiv.querySelector('img').src = data.image;
            }
        });
    </script>
</body>
</html>



<!-- worjed but black image caputre
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Webcam Image</title>
</head>
<body>
    <h1>User Webcam Image</h1>
    <div id="boxContainer"></div>

    <video id="localVideo" autoplay muted style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <button id="captureButton">Capture Image</button>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
        const boxContainer = document.getElementById('boxContainer');
        const localVideo = document.getElementById('localVideo');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const captureButton = document.getElementById('captureButton');

        // Generate a unique ID for this client
        const clientId = 'client_' + Math.random().toString(36).substr(2, 9);

        // Get webcam video stream
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                localVideo.srcObject = stream;
            })
            .catch(err => {
                console.error('Error accessing webcam: ', err);
            });

        // Capture image from webcam and send to server
        captureButton.addEventListener('click', () => {
            canvas.width = localVideo.videoWidth;
            canvas.height = localVideo.videoHeight;
            context.drawImage(localVideo, 0, 0, canvas.width, canvas.height);
            const dataURL = canvas.toDataURL('image/jpeg');
            socket.emit('image_capture', { clientId: clientId, image: dataURL });
        });

        // Receive and display broadcasted images in specific divs
        socket.on('broadcast_image', (data) => {
            let userDiv = document.getElementById(data.clientId);
            if (!userDiv) {
                userDiv = document.createElement('div');
                userDiv.id = data.clientId;
                userDiv.style.margin = "10px";
                userDiv.style.display = "inline-block";
                
                const imgElement = document.createElement('img');
                imgElement.style.width = "100px";
                imgElement.style.height = "100px";
                userDiv.appendChild(imgElement);

                boxContainer.appendChild(userDiv);
            }
            userDiv.querySelector('img').src = data.image;
        });
    </script>
</body>
</html> -->


<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Webcam Streams</title>
</head>
<body>
    <h1>User Webcam Streams</h1>
    <div id="boxContainer"></div>

    <video id="localVideo" autoplay muted style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
        const boxContainer = document.getElementById('boxContainer');

        // Generate a unique ID for this client
        const clientId = 'client_' + Math.random().toString(36).substr(2, 9);

        const localVideo = document.getElementById('localVideo');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        // Get webcam video stream
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                localVideo.srcObject = stream;

                localVideo.addEventListener('play', () => {
                    const sendVideoFrame = () => {
                        if (!localVideo.paused && !localVideo.ended) {
                            canvas.width = localVideo.videoWidth;
                            canvas.height = localVideo.videoHeight;
                            context.drawImage(localVideo, 0, 0, canvas.width, canvas.height);
                            const dataURL = canvas.toDataURL('image/jpeg');
                            socket.emit('video_frame', { clientId: clientId, frame: dataURL });
                            requestAnimationFrame(sendVideoFrame);
                        }
                    };
                    sendVideoFrame();
                });
            })
            .catch(err => {
                console.error('Error accessing webcam: ', err);
            });

        // Receive and display broadcasted video frames in specific divs
        socket.on('broadcast_frame', (data) => {
            let userDiv = document.getElementById(data.clientId);
            if (!userDiv) {
                userDiv = document.createElement('div');
                userDiv.id = data.clientId;
                userDiv.style.margin = "10px";
                userDiv.style.display = "inline-block";
                
                const imgElement = document.createElement('img');
                imgElement.style.width = "100px";
                imgElement.style.height = "100px";
                userDiv.appendChild(imgElement);

                boxContainer.appendChild(userDiv);
            }
            userDiv.querySelector('img').src = data.frame;
        });
    </script>
</body>
</html> -->



<!-- worked for random images -->
<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Images</title>
</head>
<body>
    <h1>User Images</h1>
    <div id="boxContainer"></div>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
        const boxContainer = document.getElementById('boxContainer');

        // Generate a unique ID for this client
        const clientId = 'client_' + Math.random().toString(36).substr(2, 9);

        // Predefined set of random images
        const images = [
            'https://via.placeholder.com/100/FF0000/FFFFFF/?text=User1',
            'https://via.placeholder.com/100/00FF00/FFFFFF/?text=User2',
            'https://via.placeholder.com/100/0000FF/FFFFFF/?text=User3',
            'https://via.placeholder.com/100/FFFF00/FFFFFF/?text=User4',
            'https://via.placeholder.com/100/00FFFF/FFFFFF/?text=User5'
        ];

        // Select a random image for the user's box
        const getRandomImage = () => {
            return images[Math.floor(Math.random() * images.length)];
        };

        const userImage = getRandomImage();

        // Notify the server about the new user
        socket.emit('new_user', { clientId: clientId, image: userImage });

        // Receive and display new user's image
        socket.on('new_user_image', (data) => {
            let userDiv = document.getElementById(data.clientId);
            if (!userDiv) {
                userDiv = document.createElement('div');
                userDiv.id = data.clientId;
                
                const imgElement = document.createElement('img');
                imgElement.src = data.image;
                imgElement.style.width = "100px";
                imgElement.style.height = "100px";
                
                userDiv.appendChild(imgElement);
                userDiv.style.margin = "10px";
                userDiv.style.display = "inline-block";
                
                boxContainer.appendChild(userDiv);
            }
        });
    </script>
</body>
</html> -->

<!-- workded for box with colors -->
<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Boxes</title>
</head>
<body>
    <h1>User Boxes</h1>
    <div id="boxContainer"></div>
    
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);
        const boxContainer = document.getElementById('boxContainer');

        // Generate a unique ID for this client
        const clientId = 'client_' + Math.random().toString(36).substr(2, 9);

        // Generate a random color for the user's box
        const getRandomColor = () => {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        };

        const userColor = getRandomColor();

        // Notify the server about the new user
        socket.emit('new_user', { clientId: clientId, color: userColor });

        // Receive and display new user's box
        socket.on('new_user_box', (data) => {
            let userDiv = document.getElementById(data.clientId);
            if (!userDiv) {
                userDiv = document.createElement('div');
                userDiv.id = data.clientId;
                userDiv.style.backgroundColor = data.color;
                userDiv.style.width = "100px";
                userDiv.style.height = "100px";
                userDiv.style.margin = "10px";
                userDiv.style.display = "inline-block";
                boxContainer.appendChild(userDiv);
            }
        });
    </script>
</body>
</html> -->



<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Stream</title>
</head>
<body>
    <h1>Video Stream</h1>
    <div id="videoContainer"></div>

    <video id="localVideo" autoplay muted style="display:none;"></video>
    <canvas id="canvas" style="display:none;"></canvas>

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);

        const localVideo = document.getElementById('localVideo');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');
        const videoContainer = document.getElementById('videoContainer');

        // Generate a unique ID for this client
        const clientId = 'client_' + Math.random().toString(36).substr(2, 9);

        // Get webcam video stream
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                localVideo.srcObject = stream;

                localVideo.addEventListener('play', () => {
                    const sendVideoFrame = () => {
                        if (!localVideo.paused && !localVideo.ended) {
                            canvas.width = localVideo.videoWidth;
                            canvas.height = localVideo.videoHeight;
                            context.drawImage(localVideo, 0, 0, canvas.width, canvas.height);
                            const dataURL = canvas.toDataURL('image/jpeg');
                            socket.emit('video_frame', { clientId: clientId, frame: dataURL });
                            requestAnimationFrame(sendVideoFrame);
                        }
                    };
                    sendVideoFrame();
                });
            })
            .catch(err => {
                console.error('Error accessing webcam: ', err);
            });

        // Receive and display broadcasted video frames in specific divs
        socket.on('broadcast_frame', (data) => {
            let userDiv = document.getElementById(data.clientId);
            if (!userDiv) {
                userDiv = document.createElement('div');
                userDiv.id = data.clientId;
                userDiv.style.border = "2px solid black";
                userDiv.style.margin = "10px";
                userDiv.style.width = "320px";
                userDiv.style.height = "240px";
                userDiv.style.display = "inline-block";
                
                const imgElement = document.createElement('img');
                imgElement.style.width = "100%";
                imgElement.style.height = "100%";
                userDiv.appendChild(imgElement);
                
                videoContainer.appendChild(userDiv);
            }
            userDiv.querySelector('img').src = data.frame;
        });
    </script>
</body>
</html>

 -->

<!-- working only one user -->
<!-- <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Stream</title>
</head>
<body>
    <h1>Video Stream</h1>
    <video id="localVideo" autoplay muted></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <img id="receivedVideo" />

    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
    <script>
        const socket = io.connect('http://' + document.domain + ':' + location.port);

        const localVideo = document.getElementById('localVideo');
        const receivedVideo = document.getElementById('receivedVideo');
        const canvas = document.getElementById('canvas');
        const context = canvas.getContext('2d');

        // Get webcam video stream
        navigator.mediaDevices.getUserMedia({ video: true })
            .then(stream => {
                localVideo.srcObject = stream;

                localVideo.addEventListener('play', () => {
                    const sendVideoFrame = () => {
                        if (!localVideo.paused && !localVideo.ended) {
                            context.drawImage(localVideo, 0, 0, canvas.width, canvas.height);
                            const dataURL = canvas.toDataURL('image/jpeg');
                            socket.emit('video_frame', dataURL);
                            requestAnimationFrame(sendVideoFrame);
                        }
                    };
                    sendVideoFrame();
                });
            })
            .catch(err => {
                console.error('Error accessing webcam: ', err);
            });

        // Receive and display broadcasted video frames
        socket.on('broadcast_frame', (data) => {
            receivedVideo.src = data;
        });
    </script>
</body>
</html> -->
